CLASS zcl_emp_salary_amdp DEFINITION
  PUBLIC
  FINAL
  CREATE PUBLIC .

  PUBLIC SECTION.
    INTERFACES if_amdp_marker_hdb.
    CLASS-METHODS: get_agg_emp_salary FOR TABLE FUNCTION ZGTF_EMP_SALARY_H2.
  PROTECTED SECTION.
  PRIVATE SECTION.
ENDCLASS.



CLASS zcl_emp_salary_amdp IMPLEMENTATION.
  METHOD GET_AGG_EMP_SALARY BY DATABASE FUNCTION
    FOR HDB
    LANGUAGE SQLSCRIPT
    OPTIONS READ-ONLY
    USING ZEMP_SALARY_H2.

    RETURN
      SELECT client as clnt,
             CAST(DEPT_ID AS CHAR(10)) AS DEPT_ID,
             CAST(SUM(BASIC_PAY) AS DECIMAL(15,2))  AS TOTAL_BASIC,
             CAST(SUM(ALLOWANCE) AS DECIMAL(15,2))  AS TOTAL_ALLOW,
             CAST(SUM(DEDUCTIONS) AS DECIMAL(15,2)) AS TOTAL_DED,
             CAST(SUM(BASIC_PAY + ALLOWANCE - DEDUCTIONS) AS DECIMAL(15,2)) AS TOTAL_NET
      FROM ZEMP_SALARY_H2
      GROUP BY DEPT_ID, client;

  ENDMETHOD.

ENDCLASS.
